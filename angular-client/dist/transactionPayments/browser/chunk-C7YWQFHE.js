import{a as Ce}from"./chunk-KVYDP3SW.js";import{a as De}from"./chunk-U2KI6PSQ.js";import{a as ne}from"./chunk-F6MBCUBG.js";import{b as oe,c as re,d as T,e as ae,f as le,h as v,i as ce,j as de,k as se,l as me,o as pe,s as ue,t as he,u as _e,v as fe,w as ge,y as ve}from"./chunk-NGUZVOSX.js";import{a as U}from"./chunk-GJJVJTXG.js";import"./chunk-CSO4ZWHK.js";import{A as z,B as H,C as Q,L as Y,P as Z,Q as J,R as K,S as X,U as ee,V as te,W as ie,u as O,z as $}from"./chunk-IBYGZ3TV.js";import{Cb as P,Ga as C,Ia as d,N as M,Ob as j,Pb as B,Ta as m,Tb as R,Ua as r,V as I,Va as h,W as b,Wa as F,Xa as x,Za as S,ab as y,cb as p,cc as G,fb as g,la as k,mb as L,nb as u,oa as l,ob as V,pa as f,pb as q,qb as w,rb as E,sb as N,ub as W}from"./chunk-ICF7HI7T.js";import"./chunk-ENQRHBTS.js";function Fe(t,s){if(t&1&&(m(0,"c-col",7)(1,"label",21),u(2," UPI ID "),r(),h(3,"input",22),r()),t&2){let e=p();l(3),g("value",e.merchantData==null||e.merchantData.accountDetails==null?null:e.merchantData.accountDetails.upiId)}}function xe(t,s){if(t&1&&(m(0,"c-col",7)(1,"label",23),u(2," Account Name "),r(),h(3,"input",24),r()),t&2){let e=p();l(3),g("value",e.merchantData==null||e.merchantData.accountDetails==null?null:e.merchantData.accountDetails.accountName)}}function Se(t,s){if(t&1&&(m(0,"c-col",7)(1,"label",25),u(2," Account Number "),r(),h(3,"input",26),r()),t&2){let e=p();l(3),g("value",e.merchantData==null||e.merchantData.accountDetails==null?null:e.merchantData.accountDetails.accountNumber)}}function we(t,s){if(t&1&&(m(0,"c-col",7)(1,"label",27),u(2," IFSC "),r(),h(3,"input",28),r()),t&2){let e=p();l(3),g("value",e.merchantData==null||e.merchantData.accountDetails==null?null:e.merchantData.accountDetails.ifsc)}}function Ee(t,s){if(t&1&&(m(0,"label",32),u(1),r()),t&2){let e=p().$implicit;d("for",e.fieldName),l(),q(" ",e.fieldName," ")}}function Ne(t,s){t&1&&h(0,"label")}function Te(t,s){if(t&1){let e=S();m(0,"input",33),y("ngModelChange",function(n){I(e);let i=p(3);return b(i.handleFieldEvents(n))}),N("ngModelChange",function(n){I(e);let i=p().$implicit;return E(i.value,n)||(i.value=n),b(n)}),r()}if(t&2){let e=p().$implicit;d("placeholder",e.placeHolder)("type",e.fieldType),w("ngModel",e.value),d("id",e.fieldName)("name",e.fieldName)("required",e.required)}}function Ae(t,s){if(t&1){let e=S();m(0,"c-form-check")(1,"input",34),y("ngModelChange",function(n){I(e);let i=p(3);return b(i.handleFieldEvents(n))}),N("ngModelChange",function(n){I(e);let i=p().$implicit;return E(i.value,n)||(i.value=n),b(n)}),r(),m(2,"label",35),u(3),r()()}if(t&2){let e=p().$implicit;l(),w("ngModel",e.value),d("id",e.fieldName)("name",e.fieldName)("required",e.required),l(),d("for",e.fieldName),l(),V(e.fieldName)}}function Me(t,s){if(t&1&&(F(0),m(1,"c-col",7),C(2,Ee,2,2,"label",30)(3,Ne,1,0,"ng-template",null,0,P)(5,Te,1,6,"input",31)(6,Ae,4,6,"c-form-check",18),r(),x()),t&2){let e=s.$implicit,c=L(4);l(2),d("ngIf",e.fieldType!=="checkbox")("ngIfElse",c),l(3),d("ngIf",e.fieldType!=="checkbox"),l(),d("ngIf",e.fieldType==="checkbox")}}function ke(t,s){if(t&1&&(F(0),C(1,Me,7,4,"ng-container",29),x()),t&2){let e=p();l(),d("ngForOf",e.depositFields)}}function Le(t,s){if(t&1&&(m(0,"div",36)(1,"c-row",6)(2,"c-col",37)(3,"label",27),u(4," Scan the QR Code to deposit the amount "),r(),h(5,"img",38),r()()()),t&2){let e=p();l(5),d("src",e.url,k)("alt",e.merchant)}}var Xe=(()=>{let s=class s{constructor(c,n,i,A,Ie,be,ye){this.fb=c,this.toastrService=n,this.utilService=i,this.loaderService=A,this.transactionService=Ie,this.merchantService=be,this.route=ye,this.merchant="",this.depositFields=[],this.merchantData=null,this.ignoredFields=["_id","createdAt","updatedAt","__v","userId","status","type","merchantId"],this.buildForm=o=>{this.depositForm=this.fb.group({merchantId:new v(o&&o.merchantId?o.merchantId:null),amount:new v(o&&o.amount?o.amount:null,[T.required]),transactionId:new v(o&&o.transactionId?o.transactionId:null,[T.required]),mode:new v(o&&o.accountDetails?.mode?o.accountDetails?.mode:null),status:new v(o&&o.merchantId?o.merchantId:"Processing"),type:new v("Deposit")}),this.depositForm.get("merchantId")?.disable(),this.updateFieldDisability()},this.addTransaction=()=>{let o=a=>{a&&a.success?(this.toastrService.showSuccess("Success!",a.message),this.loaderService.hideLoader(),this.cancel()):(this.loaderService.hideLoader(),this.toastrService.showError("Error!",a&&a?.message?a?.message:"Something Went Wrong."))},D=a=>{this.loaderService.hideLoader(),this.toastrService.showError("Error!",a.error&&a.error?.errors?.msg?a.error.errors.msg:"Something Went Wrong.")};this.loaderService.showLoader();let _=this.mergeAdditionalFields(this.depositForm.value,this.depositFields);_.merchantId=this.id,this.transactionService.addTransaction(_,o,D)},this.mergeAdditionalFields=(o,D)=>(D.forEach(_=>{_.fieldName&&(o[_.fieldName]=_.value)}),o),this.handleFieldEvents=o=>{},this.getMerchantById=o=>{let D=a=>{a&&a.success?a.data.merchantname&&(this.merchantData=a.data,this.merchant=a.data.merchantname,this.url=a.data.accountDetails?.qrcode||"",this.depositFields=a.data.depositFields.deposits?.length?a.data.depositFields.deposits[0].typeDetails:[],this.buildForm(a.data||{})):(this.toastrService.showError("Error!",a.message),this.utilService.goto("/404")),this.loaderService.hideLoader()},_=a=>{this.loaderService.hideLoader(),this.toastrService.showError("Error!",a.error&&a.error?.errors?.msg?a.error.errors.msg:"Error while fetching merchant."),this.utilService.goto("/404")};this.loaderService.showLoader(),this.merchantService.getById({merchantId:o,for:"public",get:"bankDeposits"},D,_)},this.cancel=()=>{this.depositForm=null,this.depositFields.forEach(o=>{o.value!==""&&o.value!==null&&o.value!==void 0&&(o.value="")}),this.buildForm()}}ngOnInit(){this.route.params.subscribe(c=>{c.id?(this.id=c.id,this.getMerchantById(c.id)):(this.toastrService.showWarning("Warning!","You donot have permission to view this page!"),this.utilService.goto("/404"))}),this.buildForm()}updateFieldDisability(){this.depositForm.get("accountId")?.disable(),this.depositForm.get("accountName")?.disable(),this.depositForm.get("accountNumber")?.disable(),this.depositForm.get("ifsc")?.disable(),this.depositForm.get("upiId")?.disable(),this.depositForm.get("mode")?.disable()}getFormFields(){let c=this.depositForm.get("mode")?.value;return Object.keys(this.depositForm.controls).filter(n=>!(this.ignoredFields.includes(n)||c==="upi"&&["accountName","accountNumber","ifsc"].includes(n)||c==="imps"&&n==="upiId")).map(n=>({key:n,value:this.depositForm.get(n)?.value}))}breakCamelCase(c){return c.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/^./,n=>n.toUpperCase())}getInputType(c){return["merchantId","transactionId","status","type","accountName","upiId","mode","accountId"].includes(c)?"text":"number"}};s.\u0275fac=function(n){return new(n||s)(f(_e),f(ve),f(ne),f(U),f(De),f(Ce),f(G))},s.\u0275cmp=M({type:s,selectors:[["app-deposit-add"]],standalone:!0,features:[W],decls:38,vars:10,consts:[["tmpblank",""],[1,"bg-light","dark:bg-transparent","d-flex","flex-row","align-items-center",2,"min-height","45vh !important"],["breakpoint","md"],[1,"justify-content-center"],["lg","10","xl","8"],["cForm","",3,"formGroup"],[1,"row"],["sm","12","xs","12","md","6","lg","4",2,"padding","5px"],["cLabel","col","for","merchantId"],["cFormControl","","placeholder","Merchant Name","type","text","id","merchantId","name","merchantId","disabled","",3,"value"],["cLabel","col","for","mode"],["cFormControl","","placeholder","Type","type","text","id","mode","name","mode","disabled","",3,"value"],["sm","12","xs","12","md","6","lg","4","style","padding: 5px;",4,"ngIf"],["cLabel","col","for","amount"],["cFormControl","","placeholder","Amount","type","number","formControlName","amount","id","amount","name","amount","required",""],["cLabel","col","for","transactionId"],["cFormControl","","placeholder","Transaction Id","type","text","formControlName","transactionId","id","transactionId","name","transactionId"],[1,"row","mt-2"],[4,"ngIf"],["class","imagePreview",4,"ngIf"],["cButton","","color","primary",1,"px-4",3,"click","disabled"],["cLabel","col","for","UPIID"],["cFormControl","","placeholder","Type","type","text","id","UPIID","name","UPIID","disabled","",3,"value"],["cLabel","col","for","accountName"],["cFormControl","","placeholder","Type","type","text","id","accountName","name","accountName","disabled","",3,"value"],["cLabel","col","for","accountNumber"],["cFormControl","","placeholder","Type","type","text","id","accountNumber","name","accountNumber","disabled","",3,"value"],["cLabel","col","for","ifsc"],["cFormControl","","placeholder","Type","type","text","id","ifsc","name","ifsc","disabled","",3,"value"],[4,"ngFor","ngForOf"],["cLabel","col",3,"for",4,"ngIf","ngIfElse"],["cFormControl","",3,"placeholder","type","ngModel","id","name","required","ngModelChange",4,"ngIf"],["cLabel","col",3,"for"],["cFormControl","",3,"ngModelChange","placeholder","type","ngModel","id","name","required"],["cFormCheckInput","","type","checkbox",3,"ngModelChange","ngModel","id","name","required"],["cFormCheckLabel","",3,"for"],[1,"imagePreview"],["sm","12","xs","12","md","6","lg","6",2,"padding","5px"],["height","300px","width","300px",3,"src","alt"]],template:function(n,i){n&1&&(m(0,"div",1)(1,"c-container",2)(2,"c-row",3)(3,"c-col",4)(4,"c-card-group")(5,"c-card")(6,"c-card-header"),u(7,"Deposit Request Form"),r(),m(8,"c-card-body")(9,"form",5)(10,"c-row",6)(11,"c-col",7)(12,"label",8),u(13," Merchant "),r(),h(14,"input",9),r(),m(15,"c-col",7)(16,"label",10),u(17," Payment Type "),r(),h(18,"input",11),r(),C(19,Fe,4,1,"c-col",12)(20,xe,4,1,"c-col",12)(21,Se,4,1,"c-col",12)(22,we,4,1,"c-col",12),m(23,"c-col",7)(24,"label",13),u(25," Amount "),r(),h(26,"input",14),r(),m(27,"c-col",7)(28,"label",15),u(29," Transaction Id "),r(),h(30,"input",16),r()()(),m(31,"c-row",17),C(32,ke,2,1,"ng-container",18),r(),C(33,Le,6,2,"div",19),m(34,"c-row",17)(35,"c-col",7)(36,"button",20),y("click",function(){return i.addTransaction()}),u(37," Submit "),r()()()()()()()()()()),n&2&&(l(9),d("formGroup",i.depositForm),l(5),g("value",i.merchantData==null?null:i.merchantData.merchantname),l(4),g("value",i.merchantData==null||i.merchantData.accountDetails==null?null:i.merchantData.accountDetails.mode),l(),d("ngIf",(i.merchantData==null||i.merchantData.accountDetails==null?null:i.merchantData.accountDetails.mode)==="upi"),l(),d("ngIf",(i.merchantData==null||i.merchantData.accountDetails==null?null:i.merchantData.accountDetails.mode)==="imps"),l(),d("ngIf",(i.merchantData==null||i.merchantData.accountDetails==null?null:i.merchantData.accountDetails.mode)==="imps"),l(),d("ngIf",(i.merchantData==null||i.merchantData.accountDetails==null?null:i.merchantData.accountDetails.mode)==="imps"),l(10),d("ngIf",i.depositFields.length),l(),d("ngIf",i.url&&i.url!==""),l(3),d("disabled",i.depositForm.invalid))},dependencies:[fe,de,re,se,oe,ae,le,ue,he,ce,R,j,B,ge,me,pe,ee,ie,te,Q,H,$,z,Y,X,O,J,K,Z]});let t=s;return t})();export{Xe as DepositAddComponent};
